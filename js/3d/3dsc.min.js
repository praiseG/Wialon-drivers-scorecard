var callbacks={},timeToSeconds=function(e){var o=e.split(":");return 3600*+o[0]+60*+o[1]+ +o[2]},getTransporterFromUnitName=function(e){if(e)return start=e.indexOf("("),end=e.indexOf(")"),transporter=e.slice(start+1,end),unit_license=e.slice(0,start),{transporter:transporter,unit_license:unit_license}},showPickerFields=function(){var e=Cookies.getJSON("rDates");console.log(e);var o=e.fDate,t=e.tDate;$("#fromDate").val(o),$("#toDate").val(t),console.log(o),$("#fromDate").datepicker({dateFormat:"dd.mm.yy"}),$("#toDate").datepicker({dateFormat:"dd.mm.yy"}),$(".picker-display").hide(),$(".picker-fields").show()},showPickerDisplays=function(e,o){console.log(Cookies.getJSON("rDates")),"wDate"==e||"mDate"==e?$("#selDate").addClass("form-control-sel"):$("#selDate").removeClass("form-control-sel"),$("#selDate").val(o),$(".picker-fields").hide(),$(".picker-display").show()},setCookies=function(e,o){ck=Cookies.get(e),null!=ck&&Cookies.remove(e),Cookies.set(e,o)},getDates=function(e){setCookies("period",e),"tDate"==e?(minDate=maxDate=Date.today().toString("dd.MM.yyyy"),setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",minDate),showPickerDisplays(e,minDate)):"yDate"==e?(minDate=maxDate=Date.parse("yesterday").toString("dd.MM.yyyy"),setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",minDate),showPickerDisplays(e,minDate)):"wDate"==e?(minDate=Date.today().last().week().toString("dd.MM.yyyy"),maxDate=Date.today().toString("dd.MM.yyyy"),sDate=minDate+"-"+maxDate,setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",sDate),showPickerDisplays(e,sDate)):"mDate"==e?(minDate=(new Date).moveToFirstDayOfMonth().toString("dd.MM.yyyy"),maxDate=(new Date).moveToLastDayOfMonth().toString("dd.MM.yyyy"),sDate=minDate+"-"+maxDate,setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",sDate),showPickerDisplays(e,sDate)):"cDate"==e&&(showPickerFields(),Cookies.remove("selDates"))},getNextDate=function(e){console.log(e)},getPreviousDate=function(e){console.log(e)},getTimeIntervalFromInput=function(){return t_from=$("#fromDate").val(),t_to=$("#toDate").val(),t_from&&t_to?[][(t_from,t_to)]:null};function ie(){return-1!=navigator.appVersion.indexOf("MSIE 6")||-1!=navigator.appVersion.indexOf("MSIE 7")||-1!=navigator.appVersion.indexOf("MSIE 8")}var execCallback=function(e){callbacks[e]&&callbacks[e].call()};function wrapCallback(e){var o=(new Date).getTime();return callbacks[o]=e,o}function getHtmlVar(e){if(!e)return null;for(var o=decodeURIComponent(document.location.search.substr(1)).split("&"),t=0;t<o.length;t++){var r=o[t].split("=");if(r[0]==e)return r.splice(0,1),r.join("=")}return null}function loadScript(e,o){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("charset","UTF-8"),t.setAttribute("src",e),o&&"function"==typeof o&&(wrapCallback(o),ie()?t.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||o()}:t.setAttribute("onLoad","execCallback("+wrapCallback(o)+")")),document.getElementsByTagName("head")[0].appendChild(t)}function login(e){if(console.log("Code: "+e),e)alert("Login Error");else{var o=wialon.core.Session.getInstance().getCurrUser().getName();document.getElementById("username").innerHTML=o,window.setTimeout(function(){$("#rTemplates").val("Drivers_Score_Card").trigger("change")},2e3),window.onbeforeunload=function(){wialon.core.Session.getInstance().logout()}}}function initSdk(){console.log("Initializing SDK");var e=getHtmlVar("baseUrl")||getHtmlVar("HostUrl");if(console.log("url: "+e),e){var o=getHtmlVar("user")||"",t=getHtmlVar("sid"),r=getHtmlVar("authHash");wialon.core.Session.getInstance().initSession(e),r?(console.log("logging in with authHash"),wialon.core.Session.getInstance().loginAuthHash(r,login)):(console.log("logging in with sid"),wialon.core.Session.getInstance().duplicate(t,o,!0,login))}}var clearReportResult=function(){console.log("inside clear report  result");wialon.core.Session.getInstance();wialon.core.Remote.getInstance().remoteCall("report/cleanup_result",{},function(e,o){e?console.log(wialon.core.Errors.getErrorText(e)):(console.log("clear code"),console.log(e))})},fetchUnits=function(){var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:o,mode:0}],function(o){if(console.log("codefu "+o),o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_unit");if((t=wialon.util.Helper.filterItems(t,wialon.item.Item.accessFlag.execReports))&&t.length){console.log("units hereee orig"),console.log(t);for(var r=$("#vlr-tbl").dataTable().api(),a=0,l=0;a<t.length;a++,l++){var n=t[a],s=n.getName();if(s.endsWith("(Cam)"))l--;else{n.getTripsHistory()&&(console.log("trips history here"),console.log(n.getTripsHistory()),console.log("trips hist here")),n.getCurrentTrip()&&(console.log("trips here"),console.log(n.getCurrentTrip()),console.log("trips here"));var i="unknown",c="unknown",g="unknown",d="unknown",m="unknown",u="unknown",p=_.values(n.getCustomFields());_.size(p)>0&&_.each(p,function(e,o,t){"Site Name"==e.n?i=e.v:"Site ID"==e.n&&(c=e.v)});var v=_.values(n.getProfileFields());_.size(v)>0&&_.each(v,function(e,o,t){"year"==e.n?g=e.v:"brand"==e.n?d=e.v:"model"==e.n?m=e.v:"vin"==e.n&&(u=e.v)});var f="unknown",w=n.getPosition();w&&(f=wialon.util.DateTime.formatTime(w.t));var h=getTransporterFromUnitName(s),y=h.transporter,b=h.unit_license,D={id:l+1,icon_url:n.getIconUrl(32),transporter_id:y,license_number:b,vin:u,year_mke_model:g+"/"+d+"/"+m,site_name:i,site_id:c,ivms_id:n.getUniqueId(),last_gps_conn:f,last_trip_dt:f},I=_.template($("#vlr-data").html());r.row.add($(I({vhl:D})))}}r.row(0).remove().draw()}else console.log("Units not found")}})},fetchDrivers=function(){var e=wialon.core.Session.getInstance();e.loadLibrary("resourceDrivers"),e.loadLibrary("resourceDriverUnits"),e.loadLibrary("itemDriver"),e.loadLibrary("itemCustomFields");var o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Resource.dataFlag.drivers,wialon.item.Resource.dataFlag.driverUnits,wialon.item.Item.dataFlag.customFields,16384);e.updateDataFlags([{type:"type",data:"avl_resource",flags:o,mode:0},{type:"type",data:"avl_unit",flags:o,mode:0}],function(o){if(o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_resource");if(console.log("***************resources**********"),console.log(t),console.log("***************resources**********"),t&&t.length){for(var r=$("#dlr-tbl").dataTable().api(),a=0;a<t.length;a++){var l=t[a],n=l.getName(),s=_.values(l.getDrivers());if(console.log("res: "+n),console.log("reports"),_.size(s)>0)for(var i=0;i<s.length;i++){var c=s[i],g=c.n;c.id;console.log("--------dr-------------------"),console.log(c);var d="unknown",m="unknown",u="unknown",p="unknown",v="unknown",f="N/A";if(c.bu){console.log("driver Units");var w=e.getItem(c.bu);f=getTransporterFromUnitName(w.getName()).transporter,console.log(c.bu),console.log(w),console.log("Units after")}var h=c.jp;_.size(h)>0&&(_.has(h,"Site Name")&&(d=h["Site Name"]),_.has(h,"IVMS ID")&&(u=h["IVMS ID"]),_.has(h,"Site ID")&&(m=h["Site ID"]),_.has(h,"License ID")&&(p=h["License ID"]),_.has(h,"License Expiry")&&(v=h["License Expiry"]),console.log("site_name in:"+d)),console.log("site_name out:"+d);var y={id:i+1,icon_url:null,transporter_id:f,name:g,driver_id:u,driver_license:p,site_name:d,site_id:m,license_expiry:v},b=_.template($("#dlr-data").html());r.row.add($(b({drv:y})))}}r.row(0).remove().draw()}else console.log("No Resources found")}})};function getTableValue(e){return"object"==typeof e?"string"==typeof e.t?e.t:"":e}var executeReport=function(e){console.log("inside execReport");var o=wialon.core.Session.getInstance(),t=o.getCurrUser().getAccountId(),r=e.u_id;t=15452548,console.log("res_id: "+t),console.log("unit_id : "+r);var a=o.getServerTime(),l=parseInt(604800,10);l=1521849600,a=1529884740,console.log("t_to :"+a),console.log("t_from :"+l);var n=e.dt,s=0,i=0,c=0,g=0,d=0,m=0,u=0,p=0,v=[{svc:"report/exec_report",params:{reportResourceId:t,reportTemplateId:48,reportObjectId:r,reportObjectSecId:0,interval:{flags:0,from:l,to:a}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",v,function(o,t){if(console.log("obj outside"),console.log(o),console.log(t),console.log("obj out end"),0===o&&t&&t.length&&!("error"in t[0])&&"reportResult"in t[0]&&t[0].reportResult.tables.length>0){if(console.log("report successful see obj below"),console.log(t),!("error"in t[1])){eco_rows=t[1],console.log("eco driving params");for(var r=0;r<eco_rows.length;r++){var a=eco_rows[r].c[0].t;console.log(a),"Harsh Acceleration"==a?(d=eco_rows[r].c[2].t,m=eco_rows[r].c[1].t,s+=parseInt(m)):"Harsh Braking"==a&&(u=eco_rows[r].c[2].t,p=eco_rows[r].c[1].t,s+=parseInt(p))}}if(!("error"in t[2])){ovs_rows=t[2],console.log("over speeding durations");for(var l=0;l<ovs_rows.length;l++)t_sec=timeToSeconds(ovs_rows[l].c[1].t),console.log(t_sec),c++,g+=parseInt(t_sec/60),s+=g}0<=(i=Math.round(s/e.mileage*100))<=2?"green":2<i<=5?"yellow":i>5&&"red",console.log("ovs count :"+c),console.log("ovs pnalty :"+g),console.log("hacc count :"+d),console.log("hacc pnalty :"+m),console.log("hbrk count :"+u),console.log("hbrk pnalty :"+p),console.log("total pnalty :"+s),console.log("ovs count :"+c),console.log("ovs pnalty :"+g),console.log("hacc count :"+d),console.log("hacc pnalty :"+m),console.log("hbrk count :"+u),console.log("hbrk pnalty :"+p),console.log("total pnalty :"+s);var v={id:e.row_id+1,transporter_id:e.tp_id,drv_name:e.u_lic,drv_lic:"unknown",tot_mileage:e.mileage.toLocaleString("en"),site_name:"unknown",hbrk_penalty:p,hbrk_occur:u,hacc_penalty:m,hacc_occur:d,ovs_penlty:g,ovs_duration:c,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:i},f=_.template($("#dsc-data").html());n.row.add($(f({dsc:v}))),1==e.row_id&&n.row(0).remove(),n.draw()}})},getDriverScoreFactorsRecursie=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:o,mode:0}],function(o){if(console.log("code in updateflags "+o),o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_unit");if((t=wialon.util.Helper.filterItems(t,wialon.item.Item.accessFlag.execReports))&&t.length){console.log(t);$("#dsc-tbl").dataTable().api(),e.getCurrUser().getAccountId();15452548}else console.log("Units not found")}})},getDriverScoreFactors2=function(){console.log("drivers score card here")},getDriverScoreFactors3=function(){var e=wialon.core.Session.getInstance(),o=wialon.item.Item.dataFlag.base|wialon.item.Resource.dataFlag.reports,t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.loadLibrary("resourceReports"),e.updateDataFlags([{type:"type",data:"avl_resource",flags:o,mode:0},{type:"type",data:"avl_unit",flags:t,mode:0},{type:"type",data:"avl_unit_group",flags:t,mode:0}],function(o){if(o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_resource"),r=e.getItems("avl_unit_group");if(r&&t.length)if(t&&t.length){var a=t[0];console.log("resource hereeeeeeeeeee"),console.log(a),console.log("all unit groups"),console.log(r),console.log("all resources");for(var l=null,n=0;n<r.length;n++)".All Units (LH UG)"==r[n].getName()&&(l=r[n].getId(),console.log("ug name"),console.log(r[n].getName()),console.log("ug_id in :"+l));if(console.log("ug_id out :"+l),l){var s=a.getReport(49),i=e.getServerTime(),c={from:i-parseInt(7776e3,10),to:i,flags:wialon.item.MReport.intervalFlag.absolute},g=($("#dsc-tbl").dataTable().api(),e.getItems("avl_unit"));if(g&&g.length){var d=g[2];u_name=d.getName();getTransporterFromUnitName(u_name).transporter,d.getMileageCounter();console.log("rep unit"),console.log(d);var m=d.getId();window.setTimeout(function(){a.execReport(s,m,0,c,function(e,o){if(e)console.log(wialon.core.Errors.getErrorText(e));else{var t=o.getTables();if(t.length){console.log("report data here"),console.log(o);for(var r=0;r<t.length;r++){var a="<b>"+t[r].label+"-"+u_name+"</b><div class='wrap'><table style='width:100%'>",l=t[r].header;a+="<tr>";for(var n=0;n<l.length;n++)a+="<th>"+l[n]+"</th>";a+="</tr>",o.getTableRows(r,0,t[r].rows,qx.lang.Function.bind(function(e,o,t){if(o)console.log(wialon.core.Errors.getErrorText(o));else{for(var r in t){e+="<tr"+(r%2==1?" class='odd' ":"")+">";for(var a=0;a<t[r].c.length;a++)e+="<td>"+getTableValue(t[r].c[a])+"</td>";e+="</tr>"}e+="</table>",$("#reprt-data-sc").html(e+"</div><br />")}},this,a))}}}})},1e3)}else console.log("Units not found")}else alert("No Unit Group found")}else console.log("No Resources found");else console.log("No Unit Groups found")}})},getDriverScoreFactorsWhole=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:o,mode:0}],function(o){if(console.log("codefu "+o),o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_unit");if((t=wialon.util.Helper.filterItems(t,wialon.item.Item.accessFlag.execReports))&&t.length){console.log(t);var r=$("#dsc-tbl").dataTable().api();e.getCurrUser().getAccountId();15452548;for(var a=0,l=0;a<t.length;a++,l++){var n=t[a],s=n.getName();if(console.log("unit ========================="+s),s.endsWith("(Cam)"))l--;else{var i=getTransporterFromUnitName(s),c=i.transporter,g=i.unit_license,d=n.getMileageCounter(),m=n.getId();console.log("unit_id : "+m);var u=e.getServerTime(),p=parseInt(604800,10);p=1521849600,u=1529884740,console.log("t_to :"+u),console.log("t_from :"+p);var v=0,f=0,w=0,h=0,y=0,b=0,D=0,I=0,F=null,k=[{svc:"report/exec_report",params:{reportResourceId:15452548,reportTemplateId:48,reportObjectId:m,reportObjectSecId:0,interval:{flags:0,from:p,to:u}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",k,function(e,o){if(0===e&&o&&o.length&&!("error"in o[0])&&"reportResult"in o[0]&&o[0].reportResult.tables.length>0){if(console.log("report successful see obj below"),console.log(o),!("error"in o[1])){eco_rows=o[1],console.log("eco driving params");for(var t=0;t<eco_rows.length;t++){var n=eco_rows[t].c[0].t;console.log(n),"Harsh Acceleration"==n?(y=eco_rows[t].c[2].t,b=eco_rows[t].c[1].t,v+=parseInt(b)):"Harsh Braking"==n&&(D=eco_rows[t].c[2].t,I=eco_rows[t].c[1].t,v+=parseInt(I))}}if(!("error"in o[2])){ovs_rows=o[2],console.log("over speeding durations");for(var s=0;s<ovs_rows.length;s++)t_sec=timeToSeconds(ovs_rows[s].c[1].t),console.log(t_sec),w++,h+=parseInt(t_sec/60),v+=h}0<=(f=Math.round(v/d*100))<=2?F="green":2<f<=5?F="yellow":f>5&&(F="red"),console.log("ovs count :"+w),console.log("ovs pnalty :"+h),console.log("hacc count :"+y),console.log("hacc pnalty :"+b),console.log("hbrk count :"+D),console.log("hbrk pnalty :"+I),console.log("total pnalty :"+v);var i={id:l+1,s_color:F,transporter_id:c,drv_name:g,drv_lic:"unknown",tot_mileage:d.toLocaleString("en"),site_name:"unknown",hbrk_penalty:I,hbrk_occur:D,hacc_penalty:b,hacc_occur:y,ovs_penlty:h,ovs_duration:w,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:f},m=_.template($("#dsc-data").html());r.row.add($(m({dsc:i}))),0==a&&r.row(0).remove(),r.draw()}})}}}else console.log("Units not found")}})},getDriverScoreFactors=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:o,mode:0}],function(o){if(console.log("codefu "+o),o)console.log(wialon.core.Errors.getErrorText(o));else{var t=e.getItems("avl_unit");if((t=wialon.util.Helper.filterItems(t,wialon.item.Item.accessFlag.execReports))&&t.length){console.log(t);var r=$("#dsc-tbl").dataTable().api();e.getCurrUser().getAccountId();15452548;var a=function(o){if(console.log("inside ca scores"),o<t.length){var l=t[o],n=l.getName();if(console.log("unit ========================="+n),n.endsWith("(Cam)"))a(o+1);else{var s=getTransporterFromUnitName(n),i=s.transporter,c=s.unit_license,g=l.getMileageCounter(),d=l.getId();console.log("unit_id : "+d);var m=e.getServerTime(),u=parseInt(604800,10);u=1521849600,m=1529884740,console.log("t_to :"+m),console.log("t_from :"+u);var p=0,v=0,f=0,w=0,h=0,y=0,b=0,D=0,I=null,F=[{svc:"report/exec_report",params:{reportResourceId:15452548,reportTemplateId:48,reportObjectId:d,reportObjectSecId:0,interval:{flags:0,from:u,to:m}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",F,function(e,t){if(console.log("closure id*******"+o),console.log("code remote: "+e),console.log(t),0===e&&t&&t.length&&!("error"in t[0])&&"reportResult"in t[0]&&t[0].reportResult.tables.length>0){if(console.log("report successful see obj below"),console.log(t),!("error"in t[1])){eco_rows=t[1];for(var l=0;l<eco_rows.length;l++){var n=eco_rows[l].c[0].t;"Harsh Acceleration"==n?(h=eco_rows[l].c[2].t,y=eco_rows[l].c[1].t,p+=parseInt(y)):"Harsh Braking"==n&&(b=eco_rows[l].c[2].t,D=eco_rows[l].c[1].t,p+=parseInt(D))}}if(!("error"in t[2])){ovs_rows=t[2];for(var s=0;s<ovs_rows.length;s++)t_sec=timeToSeconds(ovs_rows[s].c[1].t),f++,w+=parseInt(t_sec/60),p+=w}0<=(v=Math.round(p/g*100))<=2?I="green":2<v<=5?I="yellow":v>5&&(I="red"),console.log("ovs count :"+f),console.log("ovs pnalty :"+w),console.log("hacc count :"+h),console.log("hacc pnalty :"+y),console.log("hbrk count :"+b),console.log("hbrk pnalty :"+D),console.log("total pnalty :"+p);var d={id:o+1,s_color:I,transporter_id:i,drv_name:c,drv_lic:"unknown",tot_mileage:g.toLocaleString("en"),site_name:"unknown",hbrk_penalty:D,hbrk_occur:b,hacc_penalty:y,hacc_occur:h,ovs_penlty:w,ovs_duration:f,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:v},m=_.template($("#dsc-data").html());r.row.add($(m({dsc:d}))),0==o&&r.row(0).remove(),r.draw()}a(o+1)})}}};a(0)}else console.log("Units not found")}})},vlrReport=function(){var e=_.template($("#vlr-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#vlr-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Vehicles List Report"},"pdf","print"]}),console.log("in vlrReports"),fetchUnits()},dlrReport=function(){var e=_.template($("#dlr-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#dlr-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Drivers List Report"},"pdf","print"]}),fetchDrivers()},dscReport=function(){var e=_.template($("#dsc-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#dsc-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Drivers Score Card"},"pdf","print"],columnDefs:[{targets:[3],visible:!1,searchable:!1},{targets:[5],visible:!1}]}),getDriverScoreFactors()},loadReportTemplate=function(e){console.log(e),"t-dlr"==e?dlrReport():"t-vlr"==e?(console.log("in vlrTempsecton"),vlrReport()):"t-dsc"==e&&dscReport()},onLoad=function(){loadScript("https://hst-api.wialon.com/wsdk/script/wialon.js",initSdk)};$(document).ready(function(){var e=$(".active").children("input").prop("id");getDates(e),$("#dTargets label").on("click",function(){var e=$(this).children("input").prop("id");getDates(e)}),$("#rTemplates").change(function(){var e=$(this).find(":selected"),o=e.text(),t=e.prop("id");$("#reportTitle").text(o),loadReportTemplate(t)}),onLoad()});