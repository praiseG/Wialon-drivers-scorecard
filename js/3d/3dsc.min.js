var callbacks={},timeToSeconds=function(e){if(e){var t=e.split(":");return 3600*+t[0]+60*+t[1]+ +t[2]}},getTransporterFromUnitName=function(e){if(e)return start=e.indexOf("("),end=e.indexOf(")"),transporter=e.slice(start+1,end),unit_license=e.slice(0,start),{transporter:transporter,unit_license:unit_license}},showPickerFields=function(){var e=Cookies.getJSON("rDates");console.log(e);var t=e.fDate,o=e.tDate;$("#fromDate").val(t),$("#toDate").val(o),console.log(t),$("#fromDate").datepicker({dateFormat:"dd.mm.yy"}),$("#toDate").datepicker({dateFormat:"dd.mm.yy"}),$(".picker-display").hide(),$(".picker-fields").show()},showPickerDisplays=function(e,t){console.log(Cookies.getJSON("rDates")),"wDate"==e||"mDate"==e?$("#selDate").addClass("form-control-sel"):$("#selDate").removeClass("form-control-sel"),$("#selDate").val(t),$(".picker-fields").hide(),$(".picker-display").show()},setCookies=function(e,t){ck=Cookies.get(e),null!=ck&&Cookies.remove(e),Cookies.set(e,t)},getDates=function(e){setCookies("period",e),"tDate"==e?(minDate=maxDate=Date.today().toString("dd.MM.yyyy"),setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",minDate),showPickerDisplays(e,minDate)):"yDate"==e?(minDate=maxDate=Date.parse("yesterday").toString("dd.MM.yyyy"),setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",minDate),showPickerDisplays(e,minDate)):"wDate"==e?(minDate=Date.today().last().week().toString("dd.MM.yyyy"),maxDate=Date.today().toString("dd.MM.yyyy"),sDate=minDate+"-"+maxDate,setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",sDate),showPickerDisplays(e,sDate)):"mDate"==e?(minDate=(new Date).moveToFirstDayOfMonth().toString("dd.MM.yyyy"),maxDate=(new Date).moveToLastDayOfMonth().toString("dd.MM.yyyy"),sDate=minDate+"-"+maxDate,setCookies("rDates",{fDate:minDate,tDate:maxDate}),setCookies("selDates",sDate),showPickerDisplays(e,sDate)):"cDate"==e&&(showPickerFields(),Cookies.remove("selDates"))},getNextDate=function(e){console.log(e)},getPreviousDate=function(e){console.log(e)},getTimeIntervalFromInput=function(){return t_from=$("#fromDate").val(),t_to=$("#toDate").val(),t_from&&t_to?[][(t_from,t_to)]:null};function ie(){return-1!=navigator.appVersion.indexOf("MSIE 6")||-1!=navigator.appVersion.indexOf("MSIE 7")||-1!=navigator.appVersion.indexOf("MSIE 8")}var execCallback=function(e){callbacks[e]&&callbacks[e].call()};function wrapCallback(e){var t=(new Date).getTime();return callbacks[t]=e,t}function getHtmlVar(e){if(!e)return null;for(var t=decodeURIComponent(document.location.search.substr(1)).split("&"),o=0;o<t.length;o++){var a=t[o].split("=");if(a[0]==e)return a.splice(0,1),a.join("=")}return null}function loadScript(e,t){var o=document.createElement("script");o.setAttribute("type","text/javascript"),o.setAttribute("charset","UTF-8"),o.setAttribute("src",e),t&&"function"==typeof t&&(wrapCallback(t),ie()?o.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||t()}:o.setAttribute("onLoad","execCallback("+wrapCallback(t)+")")),document.getElementsByTagName("head")[0].appendChild(o)}function login(e){if(console.log("Code: "+e),e)alert("Login Error");else{var t=wialon.core.Session.getInstance().getCurrUser().getName();document.getElementById("username").innerHTML=t,window.setTimeout(function(){$("#rTemplates").val("Drivers_Score_Card").trigger("change")},2e3),window.onbeforeunload=function(){wialon.core.Session.getInstance().logout()}}}function initSdk(){console.log("Initializing SDK");var e=getHtmlVar("baseUrl")||getHtmlVar("HostUrl");if(console.log("url: "+e),e){var t=getHtmlVar("user")||"",o=getHtmlVar("sid"),a=getHtmlVar("authHash");wialon.core.Session.getInstance().initSession(e),a?(console.log("logging in with authHash"),wialon.core.Session.getInstance().loginAuthHash(a,login)):(console.log("logging in with sid"),wialon.core.Session.getInstance().duplicate(o,t,!0,login))}}var clearReportResult=function(){console.log("inside clear report  result");wialon.core.Session.getInstance();wialon.core.Remote.getInstance().remoteCall("report/cleanup_result",{},function(e,t){e?console.log(wialon.core.Errors.getErrorText(e)):(console.log("clear code"),console.log(e))})},fetchUnits=function(){var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:t,mode:0}],function(t){if(console.log("codefu "+t),t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_unit");if((o=wialon.util.Helper.filterItems(o,wialon.item.Item.accessFlag.execReports))&&o.length){console.log("units hereee orig"),console.log(o);for(var a=$("#vlr-tbl").dataTable().api(),r=0,l=0;r<o.length;r++,l++){var n=o[r],s=n.getName();if(s.endsWith("(Cam)"))l--;else{n.getTripsHistory()&&(console.log("trips history here"),console.log(n.getTripsHistory()),console.log("trips hist here")),n.getCurrentTrip()&&(console.log("trips here"),console.log(n.getCurrentTrip()),console.log("trips here"));var i="unknown",c="unknown",g="unknown",d="unknown",m="unknown",u="unknown",p=_.values(n.getCustomFields());_.size(p)>0&&_.each(p,function(e,t,o){"Site Name"==e.n?i=e.v:"Site ID"==e.n&&(c=e.v)});var v=_.values(n.getProfileFields());_.size(v)>0&&_.each(v,function(e,t,o){"year"==e.n?g=e.v:"brand"==e.n?d=e.v:"model"==e.n?m=e.v:"vin"==e.n&&(u=e.v)});var f="unknown",w=n.getPosition();w&&(f=wialon.util.DateTime.formatTime(w.t));var y=getTransporterFromUnitName(s),h=y.transporter,b=y.unit_license,D={id:l+1,icon_url:n.getIconUrl(32),transporter_id:h,license_number:b,vin:u,year_mke_model:g+"/"+d+"/"+m,site_name:i,site_id:c,ivms_id:n.getUniqueId(),last_gps_conn:f,last_trip_dt:f},I=_.template($("#vlr-data").html());a.row.add($(I({vhl:D})))}}a.row(0).remove().draw()}else console.log("Units not found")}})},fetchDrivers=function(){var e=wialon.core.Session.getInstance();e.loadLibrary("resourceDrivers"),e.loadLibrary("resourceDriverUnits"),e.loadLibrary("itemDriver"),e.loadLibrary("itemCustomFields");var t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Resource.dataFlag.drivers,wialon.item.Resource.dataFlag.driverUnits,wialon.item.Item.dataFlag.customFields,16384);e.updateDataFlags([{type:"type",data:"avl_resource",flags:t,mode:0},{type:"type",data:"avl_unit",flags:t,mode:0}],function(t){if(t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_resource");if(console.log("***************resources**********"),console.log(o),console.log("***************resources**********"),o&&o.length){for(var a=$("#dlr-tbl").dataTable().api(),r=0;r<o.length;r++){var l=o[r],n=l.getName(),s=_.values(l.getDrivers());if(console.log("res: "+n),console.log("reports"),_.size(s)>0)for(var i=0;i<s.length;i++){var c=s[i],g=c.n;c.id;console.log("--------dr-------------------"),console.log(c);var d="unknown",m="unknown",u="unknown",p="unknown",v="unknown",f="N/A";if(c.bu){console.log("driver Units");var w=e.getItem(c.bu);f=getTransporterFromUnitName(w.getName()).transporter,console.log(c.bu),console.log(w),console.log("Units after")}var y=c.jp;_.size(y)>0&&(_.has(y,"Site Name")&&(d=y["Site Name"]),_.has(y,"IVMS ID")&&(u=y["IVMS ID"]),_.has(y,"Site ID")&&(m=y["Site ID"]),_.has(y,"License ID")&&(p=y["License ID"]),_.has(y,"License Expiry")&&(v=y["License Expiry"]),console.log("site_name in:"+d)),console.log("site_name out:"+d);var h={id:i+1,icon_url:null,transporter_id:f,name:g,driver_id:u,driver_license:p,site_name:d,site_id:m,license_expiry:v},b=_.template($("#dlr-data").html());a.row.add($(b({drv:h})))}}a.row(0).remove().draw()}else console.log("No Resources found")}})};function getTableValue(e){return"object"==typeof e?"string"==typeof e.t?e.t:"":e}var executeReport=function(e){console.log("inside execReport");var t=wialon.core.Session.getInstance(),o=t.getCurrUser().getAccountId(),a=e.u_id;o=15452548,console.log("res_id: "+o),console.log("unit_id : "+a);var r=t.getServerTime(),l=parseInt(604800,10);l=1521849600,r=1529884740,console.log("t_to :"+r),console.log("t_from :"+l);var n=e.dt,s=0,i=0,c=0,g=0,d=0,m=0,u=0,p=0,v=[{svc:"report/exec_report",params:{reportResourceId:o,reportTemplateId:48,reportObjectId:a,reportObjectSecId:0,interval:{flags:0,from:l,to:r}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",v,function(t,o){if(console.log("obj outside"),console.log(t),console.log(o),console.log("obj out end"),0===t&&o&&o.length&&!("error"in o[0])&&"reportResult"in o[0]&&o[0].reportResult.tables.length>0){if(console.log("report successful see obj below"),console.log(o),!("error"in o[1])){var a=o[1];console.log("eco driving params");for(var r=0;r<a.length;r++){var l=a[r].c[0].t;console.log(l),"Harsh Acceleration"==l?(d=a[r].c[2].t,m=a[r].c[1].t,s+=parseInt(m)):"Harsh Braking"==l&&(u=a[r].c[2].t,p=a[r].c[1].t,s+=parseInt(p))}}if(!("error"in o[2])){var v=o[2];console.log("over speeding durations"),t_duration=0;for(var f=0;f<v.length;f++)t_sec=timeToSeconds(v[f].c[1].t),console.log(t_sec),c++,g+=parseInt(t_sec/60),s+=g}0<=(i=Math.round(s/e.mileage*100))<=2?(console.log("in green"),"green"):2<i<=5?(console.log("in yellow"),"yellow"):i>5&&(console.log("in red"),"red"),console.log("ovs count :"+c),console.log("ovs pnalty :"+g),console.log("hacc count :"+d),console.log("hacc pnalty :"+m),console.log("hbrk count :"+u),console.log("hbrk pnalty :"+p),console.log("total pnalty :"+s),console.log("ovs count :"+c),console.log("ovs pnalty :"+g),console.log("hacc count :"+d),console.log("hacc pnalty :"+m),console.log("hbrk count :"+u),console.log("hbrk pnalty :"+p),console.log("total pnalty :"+s);var w={id:e.row_id+1,transporter_id:e.tp_id,drv_name:e.u_lic,drv_lic:"unknown",tot_mileage:e.mileage.toLocaleString("en"),site_name:"unknown",hbrk_penalty:p,hbrk_occur:u,hacc_penalty:m,hacc_occur:d,ovs_penlty:g,ovs_duration:c,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:i},y=_.template($("#dsc-data").html());n.row.add($(y({dsc:w}))),1==e.row_id&&n.row(0).remove(),n.draw()}})},getDriverScoreFactorsRecursie=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:t,mode:0}],function(t){if(console.log("code in updateflags "+t),t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_unit");if((o=wialon.util.Helper.filterItems(o,wialon.item.Item.accessFlag.execReports))&&o.length){console.log(o);$("#dsc-tbl").dataTable().api(),e.getCurrUser().getAccountId();15452548}else console.log("Units not found")}})},getDriverScoreFactors2=function(){console.log("drivers score card here")},getDriverScoreFactors3=function(){var e=wialon.core.Session.getInstance(),t=wialon.item.Item.dataFlag.base|wialon.item.Resource.dataFlag.reports,o=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.loadLibrary("resourceReports"),e.updateDataFlags([{type:"type",data:"avl_resource",flags:t,mode:0},{type:"type",data:"avl_unit",flags:o,mode:0},{type:"type",data:"avl_unit_group",flags:o,mode:0}],function(t){if(t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_resource"),a=e.getItems("avl_unit_group");if(a&&o.length)if(o&&o.length){var r=o[0];console.log("resource hereeeeeeeeeee"),console.log(r),console.log("all unit groups"),console.log(a),console.log("all resources");for(var l=null,n=0;n<a.length;n++)".All Units (LH UG)"==a[n].getName()&&(l=a[n].getId(),console.log("ug name"),console.log(a[n].getName()),console.log("ug_id in :"+l));if(console.log("ug_id out :"+l),l){var s=r.getReport(49),i=e.getServerTime(),c={from:i-parseInt(7776e3,10),to:i,flags:wialon.item.MReport.intervalFlag.absolute},g=($("#dsc-tbl").dataTable().api(),e.getItems("avl_unit"));if(g&&g.length){var d=g[2];u_name=d.getName();getTransporterFromUnitName(u_name).transporter,d.getMileageCounter();console.log("rep unit"),console.log(d);var m=d.getId();window.setTimeout(function(){r.execReport(s,m,0,c,function(e,t){if(e)console.log(wialon.core.Errors.getErrorText(e));else{var o=t.getTables();if(o.length){console.log("report data here"),console.log(t);for(var a=0;a<o.length;a++){var r="<b>"+o[a].label+"-"+u_name+"</b><div class='wrap'><table style='width:100%'>",l=o[a].header;r+="<tr>";for(var n=0;n<l.length;n++)r+="<th>"+l[n]+"</th>";r+="</tr>",t.getTableRows(a,0,o[a].rows,qx.lang.Function.bind(function(e,t,o){if(t)console.log(wialon.core.Errors.getErrorText(t));else{for(var a in o){e+="<tr"+(a%2==1?" class='odd' ":"")+">";for(var r=0;r<o[a].c.length;r++)e+="<td>"+getTableValue(o[a].c[r])+"</td>";e+="</tr>"}e+="</table>",$("#reprt-data-sc").html(e+"</div><br />")}},this,r))}}}})},1e3)}else console.log("Units not found")}else alert("No Unit Group found")}else console.log("No Resources found");else console.log("No Unit Groups found")}})},getDriverScoreFactorsWhole=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:t,mode:0}],function(t){if(console.log("codefu "+t),t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_unit");if((o=wialon.util.Helper.filterItems(o,wialon.item.Item.accessFlag.execReports))&&o.length){console.log(o);var a=$("#dsc-tbl").dataTable().api();e.getCurrUser().getAccountId();15452548;for(var r=0,l=0;r<o.length;r++,l++){var n=o[r],s=n.getName();if(console.log("unit ========================="+s),s.endsWith("(Cam)"))l--;else{var i=getTransporterFromUnitName(s),c=i.transporter,g=i.unit_license,d=n.getMileageCounter(),m=n.getId();console.log("unit_id : "+m);var u=e.getServerTime(),p=parseInt(604800,10);p=1521849600,u=1529884740,console.log("t_to :"+u),console.log("t_from :"+p);var v=0,f=0,w=0,y=0,h=0,b=0,D=0,I=0,F=null,k=[{svc:"report/exec_report",params:{reportResourceId:15452548,reportTemplateId:48,reportObjectId:m,reportObjectSecId:0,interval:{flags:0,from:p,to:u}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",k,function(e,t){if(0===e&&t&&t.length&&!("error"in t[0])&&"reportResult"in t[0]&&t[0].reportResult.tables.length>0){if(console.log("report successful see obj below"),console.log(t),!("error"in t[1])){var o=t[1];console.log("eco driving params");for(var n=0;n<o.length;n++){var s=o[n].c[0].t;console.log(s),"Harsh Acceleration"==s?(h=o[n].c[2].t,b=o[n].c[1].t,v+=parseInt(b)):"Harsh Braking"==s&&(D=o[n].c[2].t,I=o[n].c[1].t,v+=parseInt(I))}}if(!("error"in t[2])){var i=t[2];console.log("over speeding durations");for(var m=0;m<i.length;m++)t_sec=timeToSeconds(i[m].c[1].t),console.log(t_sec),w++,y+=parseInt(t_sec/60),v+=y}0<=(f=Math.round(v/d*100))<=2?F="green":2<f<=5?F="yellow":f>5&&(F="red"),console.log("ovs count :"+w),console.log("ovs pnalty :"+y),console.log("hacc count :"+h),console.log("hacc pnalty :"+b),console.log("hbrk count :"+D),console.log("hbrk pnalty :"+I),console.log("total pnalty :"+v);var u={id:l+1,s_color:F,transporter_id:c,drv_name:g,drv_lic:"unknown",tot_mileage:d.toLocaleString("en"),site_name:"unknown",hbrk_penalty:I,hbrk_occur:D,hacc_penalty:b,hacc_occur:h,ovs_penlty:y,ovs_duration:w,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:f},p=_.template($("#dsc-data").html());a.row.add($(p({dsc:u}))),0==r&&a.row(0).remove(),a.draw()}})}}}else console.log("Units not found")}})},getDriverScoreFactors=function(){console.log("in Driver Score Card");var e=wialon.core.Session.getInstance();e.loadLibrary("itemIcon"),e.loadLibrary("itemCustomFields"),e.loadLibrary("itemProfileFields"),e.loadLibrary("unitDriveRankSettings"),e.loadLibrary("unitEvents"),e.loadLibrary("unitTripDetector");var t=wialon.util.Number.or(wialon.item.Item.dataFlag.base,wialon.item.Unit.dataFlag.lastMessage,wialon.item.Item.dataFlag.customFields,wialon.item.Item.dataFlag.adminFields,wialon.item.Item.dataFlag.customProps,wialon.item.Item.dataFlag.guid,256,8388608,131072,524288,8192);e.updateDataFlags([{type:"type",data:"avl_unit",flags:t,mode:0}],function(t){if(console.log("codefu "+t),t)console.log(wialon.core.Errors.getErrorText(t));else{var o=e.getItems("avl_unit");if((o=wialon.util.Helper.filterItems(o,wialon.item.Item.accessFlag.execReports))&&o.length){console.log(o);var a=$("#dsc-tbl").dataTable().api();e.getCurrUser().getAccountId();15452548;var r=function(t){if(console.log("inside ca scores"),t<o.length){var l=o[t],n=l.getName();if(console.log("unit ========================="+n),n.endsWith("(Cam)"))r(t+1);else{var s=getTransporterFromUnitName(n),i=s.transporter,c=s.unit_license,g=(l.getMileageCounter(),l.getId()),d=e.getServerTime(),m=parseInt(604800,10);m=1521849600,d=1529884740,console.log("t_to :"+d),console.log("t_from :"+m);var u=0,p=0,v="00:00:00",f=0,w=0,y=0,h=0,b=0,D=null,I=0,F=[{svc:"report/exec_report",params:{reportResourceId:15452548,reportTemplateId:48,reportObjectId:g,reportObjectSecId:0,interval:{flags:0,from:m,to:d}}},{svc:"report/select_result_rows",params:{tableIndex:0,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:1,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/select_result_rows",params:{tableIndex:2,config:{type:"range",data:{from:0,to:65535,level:1,rawValues:1}}}},{svc:"report/cleanup_result",params:{}}];wialon.core.Remote.getInstance().remoteCall("core/batch",F,function(e,o){if(console.log("closure id*******"+t),console.log("code remote: "+e),console.log(o),0===e&&o&&o.length&&!("error"in o[0])&&"reportResult"in o[0]&&o[0].reportResult.tables.length>0){console.log("report successful see obj below"),console.log(o);for(var l=o[0].reportResult.tables,n=0;n<l.length;n++)if("unit_ecodriving"!=l[n].name||"error"in o[n+1])if("unit_speedings"!=l[n].name||"error"in o[n+1]){if("unit_trips"==l[n].name&&!("error"in o[n+1])){var s=l[n].total[0].split(" ");I=s[0],console.log("Total Mileage : "+I)}}else{v=l[n].total[0];var g=timeToSeconds(v);f+=parseInt(g/60),u+=f,console.log("Speeding penalty total "+u)}else{for(var d=o[n+1],m=0;m<d.length;m++){var F=d[m].c[0].t;"Harsh Acceleration"==F?(w=d[m].c[2].t,y=d[m].c[1].t,u+=parseInt(y)):"Harsh Braking"==F&&(h=d[m].c[2].t,b=d[m].c[1].t,u+=parseInt(b))}console.log("eco driving penalty total "+u)}0<=(p=Math.round(u/I*100))&&p<=2?(console.log("in green"),D="green"):2<p&&p<=5?(console.log("in Yellow"),D="yellow"):p>5&&(console.log("in red"),D="red"),console.log("ovs count :"+v),console.log("ovs pnalty :"+f),console.log("hacc count :"+w),console.log("hacc pnalty :"+y),console.log("hbrk count :"+h),console.log("hbrk pnalty :"+b),console.log("total pnalty :"+u),console.log("s_color ;"+D);var k={id:t+1,s_color:D,transporter_id:i,drv_name:"unknown",vehicle_license:c,drv_lic:"unknown",tot_mileage:I.toLocaleString("en"),site_name:"unknown",hbrk_penalty:b,hbrk_occur:h,hacc_penalty:y,hacc_occur:w,ovs_penlty:f.toLocaleString("en"),ovs_duration:v,drvtime_penalty:0,drvtime_mins:0,resting_penalty:0,score:p},S=_.template($("#dsc-data").html());a.row.add($(S({dsc:k}))),0==t&&a.row(0).remove(),a.draw()}r(t+1)})}}};r(0)}else console.log("Units not found")}})},vlrReport=function(){var e=_.template($("#vlr-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#vlr-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Vehicles List Report"},"pdf","print"]}),console.log("in vlrReports"),fetchUnits()},dlrReport=function(){var e=_.template($("#dlr-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#dlr-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Drivers List Report"},"pdf","print"]}),fetchDrivers()},dscReport=function(){var e=_.template($("#dsc-cols").html());$("#rpt-table").empty(),$("#rpt-table").html(e),$("#dsc-tbl").DataTable({dom:"Bfrtip",buttons:["csv",{extend:"excelHtml5",title:"Drivers Score Card"},"pdf","print"]}),getDriverScoreFactors()},loadReportTemplate=function(e){console.log(e),"t-dlr"==e?dlrReport():"t-vlr"==e?(console.log("in vlrTempsecton"),vlrReport()):"t-dsc"==e&&dscReport()},onLoad=function(){loadScript("https://hst-api.wialon.com/wsdk/script/wialon.js",initSdk)};$(document).ready(function(){var e=$(".active").children("input").prop("id");getDates(e),$("#dTargets label").on("click",function(){var e=$(this).children("input").prop("id");getDates(e)}),$("#rTemplates").change(function(){var e=$(this).find(":selected"),t=e.text(),o=e.prop("id");$("#reportTitle").text(t),loadReportTemplate(o)}),onLoad()});